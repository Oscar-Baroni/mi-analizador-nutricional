import React, { useState } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, BarChart, Bar, Cell, RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis } from 'recharts';

const WeightProgressChart = () => {
  const [activeTab, setActiveTab] = useState('weight');

  // Datos de macronutrientes del día actual con colores únicos
  const macroData = [
    {
      nutriente: 'Proteínas',
      requerido: 165,
      consumido: 183,
      porcentaje: 111,
      unidad: 'g',
      color: '#3B82F6'
    },
    {
      nutriente: 'Carbohidratos',
      requerido: 200,
      consumido: 204,
      porcentaje: 102,
      unidad: 'g',
      color: '#F97316'
    },
    {
      nutriente: 'Grasas',
      requerido: 80,
      consumido: 89,
      porcentaje: 111,
      unidad: 'g',
      color: '#10B981'
    },
    {
      nutriente: 'Calorías',
      requerido: 2430,
      consumido: 2445,
      porcentaje: 101,
      unidad: 'kcal',
      color: '#8B5CF6'
    }
  ];

  // Datos completos de micronutrientes (27 micronutrientes esenciales)
  const microData = [
    { nutriente: 'Vit A', fullName: 'Vitamina A', requerido: 900, consumido: 1200, porcentaje: 133, unidad: 'μg' },
    { nutriente: 'Vit C', fullName: 'Vitamina C', requerido: 90, consumido: 180, porcentaje: 200, unidad: 'mg' },
    { nutriente: 'Vit D', fullName: 'Vitamina D', requerido: 15, consumido: 22, porcentaje: 147, unidad: 'μg' },
    { nutriente: 'Vit E', fullName: 'Vitamina E', requerido: 15, consumido: 25, porcentaje: 167, unidad: 'mg' },
    { nutriente: 'Vit K', fullName: 'Vitamina K', requerido: 120, consumido: 145, porcentaje: 121, unidad: 'μg' },
    { nutriente: 'B1', fullName: 'Tiamina (B1)', requerido: 1.2, consumido: 2.1, porcentaje: 175, unidad: 'mg' },
    { nutriente: 'B2', fullName: 'Riboflavina (B2)', requerido: 1.3, consumido: 2.8, porcentaje: 215, unidad: 'mg' },
    { nutriente: 'B3', fullName: 'Niacina (B3)', requerido: 16, consumido: 28, porcentaje: 175, unidad: 'mg' },
    { nutriente: 'B5', fullName: 'Ácido Pantoténico (B5)', requerido: 5, consumido: 8.2, porcentaje: 164, unidad: 'mg' },
    { nutriente: 'B6', fullName: 'Vitamina B6', requerido: 1.3, consumido: 2.2, porcentaje: 169, unidad: 'mg' },
    { nutriente: 'B7', fullName: 'Biotina (B7)', requerido: 30, consumido: 45, porcentaje: 150, unidad: 'μg' },
    { nutriente: 'B9', fullName: 'Folato (B9)', requerido: 400, consumido: 520, porcentaje: 130, unidad: 'μg' },
    { nutriente: 'B12', fullName: 'Vitamina B12', requerido: 2.4, consumido: 12.5, porcentaje: 521, unidad: 'μg' },
    { nutriente: 'Colina', fullName: 'Colina', requerido: 550, consumido: 680, porcentaje: 124, unidad: 'mg' },
    { nutriente: 'Calcio', fullName: 'Calcio', requerido: 1000, consumido: 1150, porcentaje: 115, unidad: 'mg' },
    { nutriente: 'Fósforo', fullName: 'Fósforo', requerido: 700, consumido: 920, porcentaje: 131, unidad: 'mg' },
    { nutriente: 'Magnesio', fullName: 'Magnesio', requerido: 420, consumido: 480, porcentaje: 114, unidad: 'mg' },
    { nutriente: 'Hierro', fullName: 'Hierro', requerido: 8, consumido: 15.2, porcentaje: 190, unidad: 'mg' },
    { nutriente: 'Zinc', fullName: 'Zinc', requerido: 11, consumido: 18.5, porcentaje: 168, unidad: 'mg' },
    { nutriente: 'Cobre', fullName: 'Cobre', requerido: 0.9, consumido: 1.4, porcentaje: 156, unidad: 'mg' },
    { nutriente: 'Manganeso', fullName: 'Manganeso', requerido: 2.3, consumido: 3.1, porcentaje: 135, unidad: 'mg' },
    { nutriente: 'Selenio', fullName: 'Selenio', requerido: 55, consumido: 85, porcentaje: 155, unidad: 'μg' },
    { nutriente: 'Cromo', fullName: 'Cromo', requerido: 35, consumido: 42, porcentaje: 120, unidad: 'μg' },
    { nutriente: 'Molibdeno', fullName: 'Molibdeno', requerido: 45, consumido: 58, porcentaje: 129, unidad: 'μg' },
    { nutriente: 'Yodo', fullName: 'Yodo', requerido: 150, consumido: 180, porcentaje: 120, unidad: 'μg' },
    { nutriente: 'Flúor', fullName: 'Flúor', requerido: 4, consumido: 3.2, porcentaje: 80, unidad: 'mg' },
    { nutriente: 'Potasio', fullName: 'Potasio', requerido: 3500, consumido: 4200, porcentaje: 120, unidad: 'mg' }
  ];

  const data = [
    {
      day: 'Día 1',
      date: '28/07/2025',
      peso: 76.10,
      grasaCorporal: 23.5,
      pesoObjetivo: 67.5,
      masaMuscular: 56.5,
      grasaVisceral: 12.5,
      metabolismoBasal: 1580
    },
    {
      day: 'Día 2',
      date: '29/07/2025',
      peso: 76.25,
      grasaCorporal: 23.5,
      pesoObjetivo: 67.5,
      masaMuscular: 56.3,
      grasaVisceral: 12.3,
      metabolismoBasal: 1575
    },
    {
      day: 'Día 3',
      date: '30/07/2025',
      peso: 77.05,
      grasaCorporal: 23.5,
      pesoObjetivo: 67.5,
      masaMuscular: 55.97,
      grasaVisceral: 12,
      metabolismoBasal: 1538
    }
  ];

  const getBarColor = (porcentaje) => {
    if (porcentaje >= 100) return '#10B981';
    if (porcentaje >= 80) return '#F59E0B';
    return '#EF4444';
  };

  const RadarTooltip = ({ active, payload }) => {
    if (active && payload && payload.length) {
      const data = payload[0].payload;
      return (
        <div className="bg-white p-3 border border-gray-300 rounded-lg shadow-lg">
          <p className="font-semibold">{data.fullName}</p>
          <p className="text-green-600">Requerido: {data.requerido} {data.unidad}</p>
          <p className="text-blue-600">Consumido: {data.consumido} {data.unidad}</p>
          <p className="text-purple-600">Cobertura: {data.porcentaje}%</p>
        </div>
      );
    }
    return null;
  };

  const CustomTooltip = ({ active, payload, label }) => {
    if (active && payload && payload.length) {
      const data = payload[0].payload;
      return (
        <div className="bg-white p-4 border border-gray-300 rounded-lg shadow-lg">
          <p className="font-semibold">{`${label} (${data.date})`}</p>
          <p className="text-blue-600">
            <span className="font-medium">Peso: </span>
            {`${data.peso} kg`}
          </p>
          <p className="text-green-600">
            <span className="font-medium">Masa Muscular: </span>
            {`${data.masaMuscular} kg`}
          </p>
          <p className="text-red-500">
            <span className="font-medium">Grasa Visceral: </span>
            {`${data.grasaVisceral}`}
          </p>
          <p className="text-orange-500">
            <span className="font-medium">Metabolismo Basal: </span>
            {`${data.metabolismoBasal} kcal`}
          </p>
          <p className="text-purple-600">
            <span className="font-medium">Grasa Corporal: </span>
            {`${data.grasaCorporal}%`}
          </p>
        </div>
      );
    }
    return null;
  };

  const MacroTooltip = ({ active, payload, label }) => {
    if (active && payload && payload.length) {
      const data = payload[0].payload;
      return (
        <div className="bg-white p-3 border border-gray-300 rounded-lg shadow-lg">
          <p className="font-semibold">{data.nutriente}</p>
          <p className="text-green-600">Requerido: {data.requerido} {data.unidad}</p>
          <p className="text-blue-600">Consumido: {data.consumido} {data.unidad}</p>
          <p className="text-purple-600">Cobertura: {data.porcentaje}%</p>
        </div>
      );
    }
    return null;
  };

  return (
    <div className="w-full max-w-6xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-lg shadow-lg">
      <div className="mb-6">
        <h2 className="text-2xl font-bold text-gray-800 mb-4">Dashboard Nutricional - Oscar Adolfo Baroni</h2>
        
        {/* Tabs */}
        <div className="flex space-x-1 bg-white rounded-lg p-1 shadow-sm mb-6">
          <button
            onClick={() => setActiveTab('weight')}
            className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
              activeTab === 'weight' 
                ? 'bg-blue-500 text-white shadow-sm' 
                : 'text-gray-700 hover:bg-gray-100'
            }`}
          >
            📈 Evolución de Peso
          </button>
          <button
            onClick={() => setActiveTab('macros')}
            className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
              activeTab === 'macros' 
                ? 'bg-blue-500 text-white shadow-sm' 
                : 'text-gray-700 hover:bg-gray-100'
            }`}
          >
            🥗 Macronutrientes Hoy
          </button>
          <button
            onClick={() => setActiveTab('micros')}
            className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
              activeTab === 'micros' 
                ? 'bg-blue-500 text-white shadow-sm' 
                : 'text-gray-700 hover:bg-gray-100'
            }`}
          >
            💊 Micronutrientes Hoy
          </button>
        </div>

        {activeTab === 'weight' && (
          <>
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="font-semibold text-gray-700">Peso Actual</h3>
                <p className="text-xl font-bold text-indigo-600">77.05 kg</p>
                <p className="text-sm text-gray-500">30/07/2025</p>
              </div>
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="font-semibold text-gray-700">Masa Muscular</h3>
                <p className="text-xl font-bold text-purple-600">55.97 kg</p>
                <p className="text-sm text-gray-500">Balanza Xiaomi</p>
              </div>
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="font-semibold text-gray-700">Grasa Visceral</h3>
                <p className="text-xl font-bold text-red-600">12</p>
                <p className="text-sm text-gray-500">Zona alta</p>
              </div>
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="font-semibold text-gray-700">Metabolismo</h3>
                <p className="text-xl font-bold text-orange-600">1,538 kcal</p>
                <p className="text-sm text-gray-500">TMB medido</p>
              </div>
            </div>

            <div className="bg-white p-4 rounded-lg shadow-md">
              <ResponsiveContainer width="100%" height={400}>
                <LineChart
                  data={data}
                  margin={{
                    top: 20,
                    right: 30,
                    left: 20,
                    bottom: 5,
                  }}
                >
                  <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                  <XAxis 
                    dataKey="day" 
                    stroke="#666"
                    fontSize={12}
                  />
                  <YAxis 
                    yAxisId="left"
                    domain={[50, 80]}
                    stroke="#666"
                    fontSize={12}
                    label={{ value: 'Peso/Masa (kg)', angle: -90, position: 'insideLeft' }}
                  />
                  <YAxis 
                    yAxisId="right"
                    orientation="right" 
                    domain={[0, 20]}
                    stroke="#666"
                    fontSize={12}
                    label={{ value: 'Grasa Visceral', angle: 90, position: 'insideRight' }}
                  />
                  <Tooltip content={<CustomTooltip />} />
                  <Legend />
                  <Line 
                    yAxisId="left"
                    type="monotone" 
                    dataKey="peso" 
                    stroke="#3B82F6" 
                    strokeWidth={3}
                    dot={{ fill: '#3B82F6', strokeWidth: 2, r: 6 }}
                    name="Peso Actual"
                  />
                  <Line 
                    yAxisId="left"
                    type="monotone" 
                    dataKey="pesoObjetivo" 
                    stroke="#10B981" 
                    strokeWidth={2}
                    strokeDasharray="5 5"
                    dot={{ fill: '#10B981', strokeWidth: 2, r: 4 }}
                    name="Peso Objetivo"
                  />
                  <Line 
                    yAxisId="left"
                    type="monotone" 
                    dataKey="masaMuscular" 
                    stroke="#8B5CF6" 
                    strokeWidth={2}
                    dot={{ fill: '#8B5CF6', strokeWidth: 2, r: 5 }}
                    name="Masa Muscular"
                  />
                  <Line 
                    yAxisId="right"
                    type="monotone" 
                    dataKey="grasaVisceral" 
                    stroke="#EF4444" 
                    strokeWidth={2}
                    dot={{ fill: '#EF4444', strokeWidth: 2, r: 5 }}
                    name="Grasa Visceral"
                  />
                </LineChart>
              </ResponsiveContainer>
            </div>

            <div className="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
              <h3 className="font-semibold text-yellow-800 mb-2">📊 Análisis Completo del Progreso</h3>
              <div className="text-sm text-yellow-700 space-y-1">
                <p>• <strong>Peso:</strong> +0.95 kg en 3 días (retención líquidos post-entreno)</p>
                <p>• <strong>Masa Muscular:</strong> 55.97 kg - Mantener con proteínas altas</p>
                <p>• <strong>Grasa Visceral:</strong> 12 (zona alta) - Priorizar reducción</p>
                <p>• <strong>Metabolismo:</strong> 1,538 kcal (menor a cálculo teórico)</p>
                <p>• <strong>Hidratación:</strong> 52.5% (insuficiente) - Aumentar ingesta hídrica</p>
                <p>• <strong>Edad biológica:</strong> 36 años (¡4 años menos!)</p>
              </div>
            </div>
          </>
        )}

        {activeTab === 'macros' && (
          <div className="space-y-6">
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              {macroData.map((macro, index) => (
                <div key={index} className="bg-white p-4 rounded-lg shadow">
                  <h3 className="font-semibold text-gray-700 text-sm">{macro.nutriente}</h3>
                  <p className="text-2xl font-bold" style={{color: macro.color}}>
                    {macro.porcentaje}%
                  </p>
                  <p className="text-xs text-gray-500">
                    {macro.consumido}/{macro.requerido} {macro.unidad}
                  </p>
                </div>
              ))}
            </div>

            <div className="bg-white p-4 rounded-lg shadow-md">
              <h3 className="text-lg font-semibold mb-4">Cobertura de Macronutrientes - Día 3</h3>
              <ResponsiveContainer width="100%" height={300}>
                <BarChart data={macroData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                  <XAxis dataKey="nutriente" fontSize={12} />
                  <YAxis fontSize={12} label={{ value: '% Cobertura', angle: -90, position: 'insideLeft' }} />
                  <Tooltip content={<MacroTooltip />} />
                  <Bar dataKey="porcentaje" radius={[4, 4, 0, 0]}>
                    {macroData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={entry.color} />
                    ))}
                  </Bar>
                </BarChart>
              </ResponsiveContainer>
            </div>

            <div className="bg-green-50 border border-green-200 rounded-lg p-4">
              <h3 className="font-semibold text-green-800 mb-2">✅ Estado de Macronutrientes</h3>
              <div className="text-sm text-green-700">
                <p>🎯 <strong>Excelente cobertura:</strong> Todos los macronutrientes superan el 100%</p>
                <p>💪 <strong>Proteínas:</strong> 183g (111%) - Óptimo para mantención muscular</p>
                <p>⚡ <strong>Carbohidratos:</strong> 204g (102%) - Perfecto para energía y recuperación</p>
                <p>🥑 <strong>Grasas:</strong> 89g (111%) - Ideal para funciones hormonales</p>
              </div>
            </div>
          </div>
        )}

        {activeTab === 'micros' && (
          <div className="space-y-6">
            <div className="bg-white p-4 rounded-lg shadow-md">
              <h3 className="text-lg font-semibold mb-4">Perfil Completo de Micronutrientes - Día 3</h3>
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h4 className="text-md font-medium mb-3 text-center">Vista Radar - Cobertura General</h4>
                  <ResponsiveContainer width="100%" height={400}>
                    <RadarChart data={microData} margin={{ top: 20, right: 20, bottom: 20, left: 20 }}>
                      <PolarGrid gridType="polygon" />
                      <PolarAngleAxis 
                        dataKey="nutriente" 
                        fontSize={10}
                        className="text-gray-600"
                      />
                      <PolarRadiusAxis 
                        angle={90} 
                        domain={[0, 250]} 
                        tick={false}
                      />
                      <Radar
                        name="Cobertura %"
                        dataKey="porcentaje"
                        stroke="#3B82F6"
                        fill="#3B82F6"
                        fillOpacity={0.3}
                        strokeWidth={2}
                        dot={{ fill: '#3B82F6', strokeWidth: 1, r: 3 }}
                      />
                      <Tooltip content={<RadarTooltip />} />
                    </RadarChart>
                  </ResponsiveContainer>
                </div>

                <div>
                  <h4 className="text-md font-medium mb-3">Resumen por Categorías</h4>
                  <div className="space-y-3 max-h-96 overflow-y-auto">
                    <div className="bg-green-50 border border-green-200 rounded-lg p-3">
                      <h5 className="font-semibold text-green-800 text-sm">✅ Vitaminas Liposolubles</h5>
                      <div className="text-xs text-green-700 mt-1 space-y-1">
                        <p>• Vit A: 133% | Vit D: 147% | Vit E: 167% | Vit K: 121%</p>
                      </div>
                    </div>
                    
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                      <h5 className="font-semibold text-blue-800 text-sm">💧 Vitaminas Hidrosolubles</h5>
                      <div className="text-xs text-blue-700 mt-1 space-y-1">
                        <p>• Vit C: 200% | B1: 175% | B2: 215% | B3: 175%</p>
                        <p>• B5: 164% | B6: 169% | B7: 150% | B9: 130%</p>
                        <p>• B12: 521% | Colina: 124%</p>
                      </div>
                    </div>

                    <div className="bg-purple-50 border border-purple-200 rounded-lg p-3">
                      <h5 className="font-semibold text-purple-800 text-sm">⚡ Macrominerales</h5>
                      <div className="text-xs text-purple-700 mt-1 space-y-1">
                        <p>• Calcio: 115% | Fósforo: 131% | Magnesio: 114%</p>
                        <p>• Potasio: 120%</p>
                      </div>
                    </div>

                    <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                      <h5 className="font-semibold text-orange-800 text-sm">🔬 Oligoelementos</h5>
                      <div className="text-xs text-orange-700 mt-1 space-y-1">
                        <p>• Hierro: 190% | Zinc: 168% | Cobre: 156%</p>
                        <p>• Selenio: 155% | Manganeso: 135%</p>
                        <p>• Cromo: 120% | Molibdeno: 129% | Yodo: 120%</p>
                      </div>
                    </div>

                    <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                      <h5 className="font-semibold text-red-800 text-sm">⚠️ Atención</h5>
                      <div className="text-xs text-red-700 mt-1">
                        <p>• Flúor: 80% (ligeramente bajo)</p>
                        <p><strong>Recomendación:</strong> Aumentar pescado o té verde</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div className="grid grid-cols-3 md:grid-cols-6 lg:grid-cols-9 gap-2">
              {microData.map((micro, index) => (
                <div key={index} className="bg-white p-2 rounded-lg shadow-sm border-l-4" 
                     style={{borderLeftColor: getBarColor(micro.porcentaje)}}>
                  <h4 className="font-medium text-gray-700 text-xs">{micro.nutriente}</h4>
                  <p className="text-sm font-bold" style={{color: getBarColor(micro.porcentaje)}}>
                    {micro.porcentaje}%
                  </p>
                </div>
              ))}
            </div>

            <div className="bg-green-50 border border-green-200 rounded-lg p-4">
              <h3 className="font-semibold text-green-800 mb-2">🎯 Análisis Completo de Micronutrientes</h3>
              <div className="text-sm text-green-700 space-y-1">
                <p>✅ <strong>26 de 27 micronutrientes</strong> cubiertos al 100% o más</p>
                <p>⚠️ <strong>Solo déficit:</strong> Flúor (80%) - fácilmente corregible</p>
                <p>🏆 <strong>Destacados:</strong> B12 (521%), B2 (215%), Vitamina C (200%)</p>
                <p>💊 <strong>Centrum Silver + alimentación:</strong> Cobertura nutricional óptima</p>
                <p>🔬 <strong>Conclusión:</strong> Perfil nutricional excepcional para tus objetivos</p>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default WeightProgressChart;